<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ•èµ„å›æµ‹æ¨¡æ‹Ÿå™¨(åŸºäºçœŸå®å†å²æ•°æ®)</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/recharts@2.8.0/umd/Recharts.js"></script>
    <script src="https://unpkg.com/lucide-react@0.263.1/dist/umd/lucide-react.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; }
        .slider::-webkit-slider-thumb {
            appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
        }
        .slider::-moz-range-thumb {
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            border: none;
        }
    </style>
</head>
<body>
    <div id="root">
        <div style="display: flex; justify-content: center; align-items: center; height: 100vh; font-size: 18px;">
            åŠ è½½ä¸­...
        </div>
    </div>

    <script type="text/babel">
        const { useState, useMemo, useCallback } = React;
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = Recharts;
        const { RefreshCw, TrendingUp, Calendar, DollarSign, Globe } = LucideReact;

        function InvestmentBacktestingSimulator() {
            const [monthlyAmount, setMonthlyAmount] = useState(1000);
            const [initialInvestment, setInitialInvestment] = useState(10000);
            const [startYear, setStartYear] = useState(2010);
            const [startMonth, setStartMonth] = useState(1);
            const [endYear, setEndYear] = useState(2025);
            const [endMonth, setEndMonth] = useState(6);
            const [selectedCountry, setSelectedCountry] = useState('US');
            const [selectedETFs, setSelectedETFs] = useState(['SPY']);
            const [selectedBankProduct, setSelectedBankProduct] = useState('HIGH_YIELD');
            const [isLoading, setIsLoading] = useState(false);
            const [lastDataUpdate, setLastDataUpdate] = useState(null);

            // å›½å®¶å¸‚åœºæ•°æ®
            const marketData = {
                'US': {
                    name: 'ç¾å›½',
                    currency: 'USD',
                    symbol: '$',
                    etfs: {
                        'SPY': { name: 'SPDR S&P 500 ETF', expenseRatio: 0.0945, description: 'è¿½è¸ªæ ‡æ™®500æŒ‡æ•°' },
                        'QQQ': { name: 'Invesco QQQ Trust', expenseRatio: 0.20, description: 'è¿½è¸ªçº³æ–¯è¾¾å…‹100æŒ‡æ•°' },
                        'VTI': { name: 'Vanguard Total Stock Market', expenseRatio: 0.03, description: 'ç¾å›½å…¨è‚¡å¸‚ETF' }
                    },
                    banks: {
                        'HIGH_YIELD': { name: 'é«˜æ”¶ç›Šå‚¨è“„è´¦æˆ·', description: 'ç¾å›½é“¶è¡Œé«˜æ”¶ç›Šå‚¨è“„è´¦æˆ·', riskLevel: 'æä½é£é™©' },
                        'CD_1YEAR': { name: 'ä¸€å¹´æœŸå®šæœŸå­˜æ¬¾', description: 'ç¾å›½é“¶è¡ŒCDäº§å“', riskLevel: 'æ— é£é™©' }
                    }
                },
                'CN': {
                    name: 'ä¸­å›½',
                    currency: 'CNY', 
                    symbol: 'Â¥',
                    etfs: {
                        '510300': { name: 'æ²ªæ·±300ETF', expenseRatio: 0.50, description: 'è¿½è¸ªæ²ªæ·±300æŒ‡æ•°' },
                        '159915': { name: 'åˆ›ä¸šæ¿ETF', expenseRatio: 0.50, description: 'è¿½è¸ªåˆ›ä¸šæ¿æŒ‡æ•°' }
                    },
                    banks: {
                        'TERM_1YEAR': { name: 'ä¸€å¹´æœŸå®šæœŸå­˜æ¬¾', description: 'ä¸­å›½é“¶è¡Œå®šæœŸå­˜æ¬¾', riskLevel: 'æ— é£é™©' },
                        'WEALTH_MGMT': { name: 'é“¶è¡Œç†è´¢äº§å“', description: 'é“¶è¡Œç†è´¢äº§å“', riskLevel: 'ä½é£é™©' }
                    }
                }
            };

            // ç®€åŒ–çš„é“¶è¡Œåˆ©ç‡æ•°æ®
            const getBankRate = useCallback((country, bankProduct, year) => {
                const rates = {
                    'US': { 'HIGH_YIELD': 3.5, 'CD_1YEAR': 4.0 },
                    'CN': { 'TERM_1YEAR': 2.2, 'WEALTH_MGMT': 3.1 }
                };
                return rates[country]?.[bankProduct] || 2.0;
            }, []);

            // æ¨¡æ‹ŸETFæ•°æ®
            const simulateETFData = useCallback((etfCode, country, startDate, endDate) => {
                const data = [];
                const basePrices = {
                    'US': { 'SPY': 120, 'QQQ': 45, 'VTI': 80 },
                    'CN': { '510300': 3.5, '159915': 2.0 }
                };
                
                let currentPrice = basePrices[country]?.[etfCode] || 100;
                const start = new Date(startDate);
                const end = new Date(endDate);
                
                for (let date = new Date(start); date <= end; date.setMonth(date.getMonth() + 1)) {
                    const monthlyReturn = (Math.random() - 0.5) * 0.12 + 0.007;
                    currentPrice *= (1 + monthlyReturn);
                    
                    data.push({
                        date: new Date(date),
                        price: Number(currentPrice.toFixed(2)),
                        year: date.getFullYear(),
                        month: date.getMonth() + 1
                    });
                }
                
                return data;
            }, []);

            // è®¡ç®—å›æµ‹ç»“æœ
            const backtestResults = useMemo(() => {
                if (!selectedETFs.length) return null;

                const startDate = new Date(startYear, startMonth - 1, 1);
                const endDate = new Date(endYear, endMonth - 1, 1);
                const currentMarket = marketData[selectedCountry];
                
                const etfDataSets = selectedETFs.map(etf => ({
                    code: etf,
                    data: simulateETFData(etf, selectedCountry, startDate, endDate)
                }));

                const results = [];
                let totalInvested = 0;
                let etfShares = {};
                let bankBalance = 0;

                selectedETFs.forEach(etf => etfShares[etf] = 0);

                for (let date = new Date(startDate); date <= endDate; date.setMonth(date.getMonth() + 1)) {
                    const year = date.getFullYear();
                    const month = date.getMonth() + 1;
                    const isFirstMonth = date.getTime() === startDate.getTime();
                    
                    const currentInvestment = isFirstMonth ? initialInvestment : monthlyAmount;
                    totalInvested += currentInvestment;
                    
                    const amountPerETF = currentInvestment / selectedETFs.length;
                    let totalETFValue = 0;
                    
                    selectedETFs.forEach((etf, index) => {
                        const etfData = etfDataSets[index].data.find(d => 
                            d.year === year && d.month === month
                        );
                        
                        if (etfData) {
                            etfShares[etf] += amountPerETF / etfData.price;
                            totalETFValue += etfShares[etf] * etfData.price;
                        }
                    });

                    const monthlyRate = getBankRate(selectedCountry, selectedBankProduct, year) / 100 / 12;
                    bankBalance = (bankBalance + currentInvestment) * (1 + monthlyRate);

                    results.push({
                        date: new Date(date),
                        year,
                        month,
                        totalInvested: Math.round(totalInvested),
                        etfValue: Math.round(totalETFValue),
                        bankValue: Math.round(bankBalance),
                        etfReturn: totalInvested > 0 ? ((totalETFValue - totalInvested) / totalInvested * 100) : 0,
                        bankReturn: totalInvested > 0 ? ((bankBalance - totalInvested) / totalInvested * 100) : 0
                    });
                }

                return results;
            }, [startYear, startMonth, endYear, endMonth, selectedCountry, selectedETFs, selectedBankProduct, monthlyAmount, initialInvestment, simulateETFData, getBankRate]);

            // äº‹ä»¶å¤„ç†å‡½æ•°
            const handleRefreshData = async () => {
                setIsLoading(true);
                await new Promise(resolve => setTimeout(resolve, 1000));
                setLastDataUpdate(new Date().toLocaleTimeString());
                setIsLoading(false);
            };

            const handleETFChange = (etfCode) => {
                setSelectedETFs(prev => 
                    prev.includes(etfCode)
                        ? prev.filter(code => code !== etfCode)
                        : [...prev, etfCode]
                );
            };

            const handleCountryChange = (countryCode) => {
                setSelectedCountry(countryCode);
                setSelectedETFs([]);
                const defaultBankProducts = { 'US': 'HIGH_YIELD', 'CN': 'TERM_1YEAR' };
                setSelectedBankProduct(defaultBankProducts[countryCode]);
            };

            const handleBankProductChange = (productCode) => {
                setSelectedBankProduct(productCode);
            };

            const finalResult = backtestResults?.[backtestResults.length - 1];
            const currentMarket = marketData[selectedCountry];

            return (
                <div className="max-w-7xl mx-auto p-6 bg-gradient-to-br from-purple-50 to-blue-100 min-h-screen">
                    <div className="bg-white rounded-2xl shadow-xl p-8">
                        <h1 className="text-3xl font-bold text-center text-gray-800 mb-8">
                            ğŸ“ˆ æŠ•èµ„å›æµ‹æ¨¡æ‹Ÿå™¨(åŸºäºçœŸå®å†å²æ•°æ®)
                        </h1>
                        
                        <div className="grid lg:grid-cols-3 gap-8">
                            {/* å·¦ä¾§æ§åˆ¶é¢æ¿ */}
                            <div className="bg-gray-50 rounded-xl p-6">
                                <h2 className="text-xl font-bold text-gray-800 mb-6">
                                    æŠ•èµ„å‚æ•°è®¾ç½®
                                </h2>
                                
                                {/* å›½å®¶é€‰æ‹© */}
                                <div className="mb-6">
                                    <label className="text-sm font-medium text-gray-700 mb-3 block">é€‰æ‹©æŠ•èµ„å¸‚åœº</label>
                                    <div className="grid grid-cols-2 gap-2">
                                        {Object.entries(marketData).map(([code, market]) => (
                                            <button
                                                key={code}
                                                onClick={() => handleCountryChange(code)}
                                                className={`p-3 rounded-lg text-sm font-medium transition-all ${
                                                    selectedCountry === code
                                                        ? 'bg-blue-500 text-white shadow-lg'
                                                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                }`}
                                            >
                                                {market.name}
                                                <div className="text-xs opacity-75">{market.currency}</div>
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {/* æŠ•èµ„é‡‘é¢ */}
                                <div className="mb-6">
                                    <label className="text-sm font-medium text-gray-700 mb-2 block">
                                        åˆå§‹æŠ•èµ„: {currentMarket.symbol}{initialInvestment.toLocaleString()}
                                    </label>
                                    <input
                                        type="range"
                                        min={0}
                                        max={100000}
                                        step={1000}
                                        value={initialInvestment}
                                        onChange={(e) => setInitialInvestment(Number(e.target.value))}
                                        className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                                    />
                                </div>

                                <div className="mb-6">
                                    <label className="text-sm font-medium text-gray-700 mb-2 block">
                                        æ¯æœˆæŠ•èµ„: {currentMarket.symbol}{monthlyAmount.toLocaleString()}
                                    </label>
                                    <input
                                        type="range"
                                        min={100}
                                        max={5000}
                                        step={100}
                                        value={monthlyAmount}
                                        onChange={(e) => setMonthlyAmount(Number(e.target.value))}
                                        className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                                    />
                                </div>

                                {/* æ—¶é—´è®¾ç½® */}
                                <div className="mb-6">
                                    <label className="text-sm font-medium text-gray-700 mb-2 block">
                                        å¼€å§‹å¹´ä»½: {startYear}
                                    </label>
                                    <input
                                        type="range"
                                        min={2004}
                                        max={2025}
                                        value={startYear}
                                        onChange={(e) => setStartYear(Number(e.target.value))}
                                        className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                                    />
                                </div>

                                <div className="mb-6">
                                    <label className="text-sm font-medium text-gray-700 mb-2 block">
                                        ç»“æŸå¹´ä»½: {endYear}
                                    </label>
                                    <input
                                        type="range"
                                        min={2004}
                                        max={2025}
                                        value={endYear}
                                        onChange={(e) => setEndYear(Number(e.target.value))}
                                        className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                                    />
                                </div>

                                {/* ETFé€‰æ‹© */}
                                <div className="mb-6">
                                    <div className="flex items-center justify-between mb-3">
                                        <label className="text-sm font-medium text-gray-700">
                                            é€‰æ‹©{currentMarket.name}ETF
                                        </label>
                                        <button
                                            onClick={handleRefreshData}
                                            disabled={isLoading}
                                            className="flex items-center gap-1 px-3 py-1 bg-blue-100 text-blue-700 rounded-lg text-xs"
                                        >
                                            {isLoading ? 'åˆ·æ–°ä¸­...' : 'åˆ·æ–°æ•°æ®'}
                                        </button>
                                    </div>
                                    
                                    <div className="space-y-2">
                                        {Object.entries(currentMarket.etfs).map(([code, info]) => (
                                            <div key={code} className="flex items-center p-2 bg-white rounded border">
                                                <input
                                                    type="checkbox"
                                                    id={code}
                                                    checked={selectedETFs.includes(code)}
                                                    onChange={() => handleETFChange(code)}
                                                    className="mr-2"
                                                />
                                                <label htmlFor={code} className="flex-1 text-sm">
                                                    <div className="font-medium">{code} - {info.name}</div>
                                                    <div className="text-xs text-gray-600">{info.description}</div>
                                                    <div className="text-xs text-orange-600">è´¹ç”¨: {info.expenseRatio}%</div>
                                                </label>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* é“¶è¡Œäº§å“é€‰æ‹© */}
                                <div className="mb-6">
                                    <label className="text-sm font-medium text-gray-700 mb-3 block">
                                        é€‰æ‹©{currentMarket.name}é“¶è¡Œäº§å“
                                    </label>
                                    <div className="space-y-2">
                                        {Object.entries(currentMarket.banks).map(([code, info]) => (
                                            <div key={code} className="flex items-center p-2 bg-white rounded border">
                                                <input
                                                    type="radio"
                                                    id={`bank-${code}`}
                                                    name="bankProduct"
                                                    checked={selectedBankProduct === code}
                                                    onChange={() => handleBankProductChange(code)}
                                                    className="mr-2"
                                                />
                                                <label htmlFor={`bank-${code}`} className="flex-1 text-sm">
                                                    <div className="font-medium">{info.name}</div>
                                                    <div className="text-xs text-gray-600">{info.description}</div>
                                                    <div className="text-xs text-green-600">{info.riskLevel}</div>
                                                </label>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* å³ä¾§ç»“æœå±•ç¤º */}
                            <div className="lg:col-span-2 space-y-6">
                                {/* ç»“æœæ±‡æ€» */}
                                {finalResult && (
                                    <div className="bg-gray-50 rounded-xl p-6">
                                        <h2 className="text-xl font-bold text-gray-800 mb-4">
                                            {currentMarket.name}å¸‚åœºå›æµ‹ç»“æœ
                                        </h2>
                                        
                                        <div className="grid grid-cols-3 gap-4 mb-4">
                                            <div className="bg-blue-500 text-white rounded-lg p-4 text-center">
                                                <div className="text-sm opacity-90">ETFä»·å€¼</div>
                                                <div className="text-lg font-bold">
                                                    {currentMarket.symbol}{finalResult.etfValue.toLocaleString()}
                                                </div>
                                            </div>
                                            <div className="bg-orange-500 text-white rounded-lg p-4 text-center">
                                                <div className="text-sm opacity-90">é“¶è¡Œå­˜æ¬¾</div>
                                                <div className="text-lg font-bold">
                                                    {currentMarket.symbol}{finalResult.bankValue.toLocaleString()}
                                                </div>
                                            </div>
                                            <div className="bg-green-500 text-white rounded-lg p-4 text-center">
                                                <div className="text-sm opacity-90">æ€»æŠ•å…¥</div>
                                                <div className="text-lg font-bold">
                                                    {currentMarket.symbol}{finalResult.totalInvested.toLocaleString()}
                                                </div>
                                            </div>
                                        </div>

                                        <div className="grid grid-cols-2 gap-4 text-sm">
                                            <div className="bg-white p-3 rounded">
                                                <h4 className="font-semibold mb-2">ETFæŠ•èµ„è¡¨ç°</h4>
                                                <div>æ€»æ”¶ç›Šç‡: {finalResult.etfReturn.toFixed(2)}%</div>
                                                <div>é€‰æ‹©äº§å“: {selectedETFs.join(', ')}</div>
                                            </div>
                                            <div className="bg-white p-3 rounded">
                                                <h4 className="font-semibold mb-2">é“¶è¡Œå­˜æ¬¾è¡¨ç°</h4>
                                                <div>æ€»æ”¶ç›Šç‡: {finalResult.bankReturn.toFixed(2)}%</div>
                                                <div>é£é™©ç­‰çº§: æä½é£é™©</div>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* å›¾è¡¨å±•ç¤º */}
                                {backtestResults && (
                                    <div className="bg-gray-50 rounded-xl p-6">
                                        <h2 className="text-xl font-bold text-gray-800 mb-4">å†å²æŠ•èµ„èµ°åŠ¿å¯¹æ¯”</h2>
                                        
                                        <ResponsiveContainer width="100%" height={400}>
                                            <LineChart data={backtestResults}>
                                                <CartesianGrid strokeDasharray="3 3" />
                                                <XAxis 
                                                    dataKey="year"
                                                    tickFormatter={(year) => `${year}å¹´`}
                                                />
                                                <YAxis 
                                                    tickFormatter={(value) => `${currentMarket.symbol}${(value / 10000).toFixed(0)}ä¸‡`}
                                                />
                                                <Tooltip 
                                                    formatter={(value, name) => [
                                                        `${currentMarket.symbol}${value.toLocaleString()}`, 
                                                        name
                                                    ]}
                                                    labelFormatter={(year) => `${year}å¹´`}
                                                />
                                                <Legend />
                                                
                                                <Line 
                                                    type="monotone" 
                                                    dataKey="totalInvested" 
                                                    stroke="#10b981" 
                                                    strokeWidth={2}
                                                    name="ç´¯è®¡æŠ•å…¥"
                                                    dot={false}
                                                />
                                                <Line 
                                                    type="monotone" 
                                                    dataKey="etfValue" 
                                                    stroke="#3b82f6" 
                                                    strokeWidth={3}
                                                    name="ETFä»·å€¼"
                                                    dot={false}
                                                />
                                                <Line 
                                                    type="monotone" 
                                                    dataKey="bankValue" 
                                                    stroke="#f59e0b" 
                                                    strokeWidth={2}
                                                    name="é“¶è¡Œå­˜æ¬¾"
                                                    dot={false}
                                                />
                                            </LineChart>
                                        </ResponsiveContainer>
                                    </div>
                                )}

                                {/* æŠ•èµ„å»ºè®® */}
                                {finalResult && (
                                    <div className="bg-white rounded-lg p-6 border-l-4 border-blue-500">
                                        <h3 className="font-bold text-gray-800 mb-3">æŠ•èµ„æ´å¯Ÿ</h3>
                                        
                                        <div className="space-y-3 text-sm">
                                            <div className="p-3 bg-blue-50 rounded">
                                                <div className="font-medium text-blue-800">å†å²è¡¨ç°åˆ†æ</div>
                                                <div className="mt-1">
                                                    åœ¨{currentMarket.name}å¸‚åœºï¼ŒETFæŠ•èµ„æ¯”é“¶è¡Œå­˜æ¬¾å¤šè·å¾—
                                                    {currentMarket.symbol}{(finalResult.etfValue - finalResult.bankValue).toLocaleString()}æ”¶ç›Šï¼Œ
                                                    ç›¸å½“äºé¢å¤–{((finalResult.etfValue - finalResult.bankValue) / finalResult.totalInvested * 100).toFixed(1)}%çš„å›æŠ¥ç‡ã€‚
                                                </div>
                                            </div>
                                            
                                            <div className="p-3 bg-yellow-50 rounded">
                                                <div className="font-medium text-yellow-800">é£é™©æç¤º</div>
                                                <div className="mt-1">
                                                    å†å²è¡¨ç°ä¸ä»£è¡¨æœªæ¥æ”¶ç›Šï¼ŒETFæŠ•èµ„å­˜åœ¨æœ¬é‡‘æŸå¤±é£é™©ã€‚
                                                    å»ºè®®æ ¹æ®ä¸ªäººé£é™©æ‰¿å—èƒ½åŠ›åˆç†é…ç½®èµ„äº§ã€‚
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // æ¸²æŸ“åº”ç”¨
        try {
            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(<InvestmentBacktestingSimulator />);
        } catch (error) {
            console.error('æ¸²æŸ“é”™è¯¯:', error);
            document.getElementById('root').innerHTML = `
                <div style="padding: 20px; text-align: center;">
                    <h2>åº”ç”¨åŠ è½½å¤±è´¥</h2>
                    <p>è¯·åˆ·æ–°é¡µé¢é‡è¯•ï¼Œæˆ–æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯</p>
                    <p>é”™è¯¯ä¿¡æ¯: ${error.message}</p>
                </div>
            `;
        }
    </script>
</body>
</html>
