<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ•èµ„å›æµ‹æ¨¡æ‹Ÿå™¨(åŸºäºçœŸå®å†å²æ•°æ®)</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/recharts@2.8.0/umd/Recharts.js"></script>
    <script src="https://unpkg.com/lucide-react@0.263.1/dist/umd/lucide-react.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .slider::-webkit-slider-thumb {
            appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
        }
        .slider::-moz-range-thumb {
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            border: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useCallback } = React;
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = Recharts;
        const { RefreshCw, TrendingUp, Calendar, DollarSign, Globe } = LucideReact;

        function InvestmentBacktestingSimulator() {
            const [monthlyAmount, setMonthlyAmount] = useState(1000);
            const [initialInvestment, setInitialInvestment] = useState(10000);
            const [startYear, setStartYear] = useState(2010);
            const [startMonth, setStartMonth] = useState(1);
            const [endYear, setEndYear] = useState(2025);
            const [endMonth, setEndMonth] = useState(6);
            const [selectedCountry, setSelectedCountry] = useState('US');
            const [selectedETFs, setSelectedETFs] = useState(['SPY']);
            const [selectedBankProduct, setSelectedBankProduct] = useState('HIGH_YIELD');
            const [isLoading, setIsLoading] = useState(false);
            const [lastDataUpdate, setLastDataUpdate] = useState(null);

            // å›½å®¶å¸‚åœºæ•°æ®
            const marketData = {
                'US': {
                    name: 'ç¾å›½',
                    currency: 'USD',
                    symbol: '$',
                    etfs: {
                        'SPY': { 
                            name: 'SPDR S&P 500 ETF Trust', 
                            expenseRatio: 0.0945, 
                            description: 'è¿½è¸ªæ ‡å‡†æ™®å°”500æŒ‡æ•°ï¼Œä»£è¡¨ç¾å›½å¤§å‹è‚¡å¸‚åœºè¡¨ç°' 
                        },
                        'VTI': { 
                            name: 'Vanguard Total Stock Market ETF', 
                            expenseRatio: 0.03, 
                            description: 'è¿½è¸ªç¾å›½æ•´ä½“è‚¡ç¥¨å¸‚åœºï¼ŒåŒ…å«å¤§ä¸­å°ç›˜è‚¡ç¥¨' 
                        },
                        'QQQ': { 
                            name: 'Invesco QQQ Trust', 
                            expenseRatio: 0.20, 
                            description: 'è¿½è¸ªçº³æ–¯è¾¾å…‹100æŒ‡æ•°ï¼Œä¸“æ³¨ç¾å›½å¤§å‹ç§‘æŠ€è‚¡' 
                        },
                        'VXUS': { 
                            name: 'Vanguard Total International Stock ETF', 
                            expenseRatio: 0.08, 
                            description: 'è¿½è¸ªç¾å›½ä»¥å¤–çš„å…¨çƒå‘è¾¾å’Œæ–°å…´å¸‚åœºè‚¡ç¥¨' 
                        },
                        'SCHB': { 
                            name: 'Schwab US Broad Market ETF', 
                            expenseRatio: 0.03, 
                            description: 'è¿½è¸ªç¾å›½å¹¿æ³›å¸‚åœºæŒ‡æ•°ï¼Œä½æˆæœ¬å…¨å¸‚åœºæŠ•èµ„' 
                        }
                    },
                    banks: {
                        'HIGH_YIELD': {
                            name: 'é«˜æ”¶ç›Šå‚¨è“„è´¦æˆ·',
                            description: 'ç¾å›½é“¶è¡Œé«˜æ”¶ç›Šå‚¨è“„è´¦æˆ·å¹³å‡åˆ©ç‡ï¼ŒFDICä¿é™©ä¿éšœ',
                            riskLevel: 'æä½é£é™©'
                        },
                        'CD_1YEAR': {
                            name: 'ä¸€å¹´æœŸå®šæœŸå­˜æ¬¾è¯æ˜(CD)',
                            description: 'ç¾å›½é“¶è¡Œä¸€å¹´æœŸå®šæœŸå­˜æ¬¾ï¼Œåˆ©ç‡å›ºå®šï¼ŒFDICä¿é™©ä¿éšœ',
                            riskLevel: 'æ— é£é™©'
                        },
                        'MONEY_MARKET': {
                            name: 'è´§å¸å¸‚åœºè´¦æˆ·',
                            description: 'ç¾å›½é“¶è¡Œè´§å¸å¸‚åœºè´¦æˆ·ï¼Œåˆ©ç‡æµ®åŠ¨ï¼ŒFDICä¿é™©ä¿éšœ',
                            riskLevel: 'æä½é£é™©'
                        }
                    }
                },
                'CA': {
                    name: 'åŠ æ‹¿å¤§',
                    currency: 'CAD',
                    symbol: 'C$',
                    etfs: {
                        'VTI.TO': { 
                            name: 'Vanguard Total Stock Market Index Fund', 
                            expenseRatio: 0.05, 
                            description: 'è¿½è¸ªåŠ æ‹¿å¤§è‚¡ç¥¨å¸‚åœºæ•´ä½“è¡¨ç°çš„æŒ‡æ•°åŸºé‡‘' 
                        },
                        'TDB902': { 
                            name: 'TD Canadian Index Fund', 
                            expenseRatio: 0.31, 
                            description: 'TDé“¶è¡ŒåŠ æ‹¿å¤§è‚¡ç¥¨æŒ‡æ•°åŸºé‡‘ï¼Œè¿½è¸ªTSXç»¼åˆæŒ‡æ•°' 
                        },
                        'VCN': { 
                            name: 'Vanguard FTSE Canada All Cap Index ETF', 
                            expenseRatio: 0.05, 
                            description: 'è¿½è¸ªåŠ æ‹¿å¤§å…¨å¸‚å€¼è‚¡ç¥¨å¸‚åœºï¼Œæ¶µç›–å¤§ä¸­å°ç›˜' 
                        },
                        'TDB900': { 
                            name: 'TD Canadian Bond Index Fund', 
                            expenseRatio: 0.33, 
                            description: 'TDé“¶è¡ŒåŠ æ‹¿å¤§å€ºåˆ¸æŒ‡æ•°åŸºé‡‘ï¼Œè¿½è¸ªåŠ æ‹¿å¤§å€ºåˆ¸å¸‚åœº' 
                        }
                    },
                    banks: {
                        'HIGH_INTEREST': {
                            name: 'é«˜æ¯å‚¨è“„è´¦æˆ·',
                            description: 'åŠ æ‹¿å¤§ä¸»è¦é“¶è¡Œé«˜æ¯å‚¨è“„è´¦æˆ·åˆ©ç‡ï¼ŒCDICå­˜æ¬¾ä¿é™©ä¿éšœ',
                            riskLevel: 'æä½é£é™©'
                        },
                        'GIC_1YEAR': {
                            name: 'ä¸€å¹´æœŸæ‹…ä¿æŠ•èµ„è¯æ˜(GIC)',
                            description: 'åŠ æ‹¿å¤§é“¶è¡Œä¸€å¹´æœŸGICäº§å“ï¼Œåˆ©ç‡ä¿è¯ï¼ŒCDICä¿é™©ä¿éšœ',
                            riskLevel: 'æ— é£é™©'
                        },
                        'TFSA': {
                            name: 'å…ç¨å‚¨è“„è´¦æˆ·(TFSA)',
                            description: 'åŠ æ‹¿å¤§å…ç¨å‚¨è“„è´¦æˆ·ï¼ŒæŠ•èµ„æ”¶ç›Šå…ç¨ï¼ŒCDICä¿é™©ä¿éšœ',
                            riskLevel: 'æä½é£é™©'
                        }
                    }
                },
                'CN': {
                    name: 'ä¸­å›½',
                    currency: 'CNY',
                    symbol: 'Â¥',
                    etfs: {
                        '510300': { 
                            name: 'åæ³°æŸç‘æ²ªæ·±300ETF', 
                            expenseRatio: 0.50, 
                            description: 'è¿½è¸ªæ²ªæ·±300æŒ‡æ•°ï¼Œä»£è¡¨ä¸­å›½Aè‚¡å¤§ç›˜è‚¡å¸‚åœºè¡¨ç°' 
                        },
                        '159915': { 
                            name: 'æ˜“æ–¹è¾¾åˆ›ä¸šæ¿ETF', 
                            expenseRatio: 0.50, 
                            description: 'è¿½è¸ªåˆ›ä¸šæ¿æŒ‡æ•°ï¼Œä»£è¡¨ä¸­å›½åˆ›æ–°æˆé•¿å‹ä¼ä¸šè¡¨ç°' 
                        },
                        '588000': { 
                            name: 'åå¤ç§‘åˆ›50ETF', 
                            expenseRatio: 0.50, 
                            description: 'è¿½è¸ªç§‘åˆ›50æŒ‡æ•°ï¼Œä¸“æ³¨ä¸­å›½ç§‘æŠ€åˆ›æ–°é¾™å¤´ä¼ä¸š' 
                        },
                        '510500': { 
                            name: 'å—æ–¹ä¸­è¯500ETF', 
                            expenseRatio: 0.50, 
                            description: 'è¿½è¸ªä¸­è¯500æŒ‡æ•°ï¼Œä»£è¡¨ä¸­å›½ä¸­ç›˜è‚¡å¸‚åœºè¡¨ç°' 
                        },
                        '513100': { 
                            name: 'åæ³°æŸç‘çº³æ–¯è¾¾å…‹100ETF', 
                            expenseRatio: 0.80, 
                            description: 'è¿½è¸ªçº³æ–¯è¾¾å…‹100æŒ‡æ•°ï¼ŒæŠ•èµ„ç¾å›½ç§‘æŠ€è‚¡' 
                        }
                    },
                    banks: {
                        'TERM_1YEAR': {
                            name: 'ä¸€å¹´æœŸå®šæœŸå­˜æ¬¾',
                            description: 'ä¸­å›½ä¸»è¦é“¶è¡Œä¸€å¹´æœŸå®šæœŸå­˜æ¬¾åˆ©ç‡ï¼Œå­˜æ¬¾ä¿é™©æ¡ä¾‹ä¿éšœ',
                            riskLevel: 'æ— é£é™©'
                        },
                        'WEALTH_MGMT': {
                            name: 'é“¶è¡Œç†è´¢äº§å“',
                            description: 'ä¸­å›½é“¶è¡Œç†è´¢äº§å“å¹³å‡æ”¶ç›Šç‡ï¼Œé£é™©ç­‰çº§R2',
                            riskLevel: 'ä½é£é™©'
                        },
                        'STRUCTURED': {
                            name: 'ç»“æ„æ€§å­˜æ¬¾',
                            description: 'ä¸­å›½é“¶è¡Œç»“æ„æ€§å­˜æ¬¾äº§å“ï¼Œä¿æœ¬æµ®åŠ¨æ”¶ç›Š',
                            riskLevel: 'æä½é£é™©'
                        }
                    }
                },
                'AU': {
                    name: 'æ¾³å¤§åˆ©äºš',
                    currency: 'AUD',
                    symbol: 'A$',
                    etfs: {
                        'VAS': { 
                            name: 'Vanguard Australian Shares Index ETF', 
                            expenseRatio: 0.10, 
                            description: 'è¿½è¸ªASX300æŒ‡æ•°ï¼Œä»£è¡¨æ¾³å¤§åˆ©äºšè‚¡ç¥¨å¸‚åœºè¡¨ç°' 
                        },
                        'A200': { 
                            name: 'BetaShares Australia 200 ETF', 
                            expenseRatio: 0.07, 
                            description: 'è¿½è¸ªASX200æŒ‡æ•°ï¼Œä¸“æ³¨æ¾³å¤§åˆ©äºšå¤§å‹è‚¡ç¥¨' 
                        },
                        'VGS': { 
                            name: 'Vanguard MSCI Index International Shares ETF', 
                            expenseRatio: 0.18, 
                            description: 'è¿½è¸ªMSCIä¸–ç•ŒæŒ‡æ•°ï¼ŒæŠ•èµ„æ¾³æ´²ä»¥å¤–çš„å…¨çƒè‚¡ç¥¨' 
                        },
                        'VAF': { 
                            name: 'Vanguard Australian Fixed Interest Index ETF', 
                            expenseRatio: 0.15, 
                            description: 'è¿½è¸ªæ¾³å¤§åˆ©äºšå›ºå®šæ”¶ç›Šå¸‚åœºï¼Œä¸»è¦æŠ•èµ„æ¾³æ´²å€ºåˆ¸' 
                        }
                    },
                    banks: {
                        'HIGH_YIELD_SAVINGS': {
                            name: 'é«˜æ¯å‚¨è“„è´¦æˆ·',
                            description: 'æ¾³å¤§åˆ©äºšå››å¤§é“¶è¡Œé«˜æ¯å‚¨è“„è´¦æˆ·åˆ©ç‡ï¼Œæ”¿åºœå­˜æ¬¾ä¿éšœ',
                            riskLevel: 'æä½é£é™©'
                        },
                        'TERM_DEPOSIT': {
                            name: 'å®šæœŸå­˜æ¬¾',
                            description: 'æ¾³å¤§åˆ©äºšé“¶è¡Œä¸€å¹´æœŸå®šæœŸå­˜æ¬¾ï¼Œåˆ©ç‡å›ºå®šä¿è¯',
                            riskLevel: 'æ— é£é™©'
                        },
                        'CASH_MGMT': {
                            name: 'ç°é‡‘ç®¡ç†è´¦æˆ·',
                            description: 'æ¾³å¤§åˆ©äºšé“¶è¡Œç°é‡‘ç®¡ç†è´¦æˆ·ï¼Œåˆ©ç‡æµ®åŠ¨',
                            riskLevel: 'æä½é£é™©'
                        }
                    }
                }
            };

            // æ ¹æ®å›½å®¶ã€é“¶è¡Œäº§å“å’Œå¹´ä»½è·å–é“¶è¡Œåˆ©ç‡
            const getBankRate = useCallback((country, bankProduct, year, month) => {
                const rateMap = {
                    'US': {
                        'HIGH_YIELD': {
                            2004: 2.5, 2005: 3.5, 2006: 4.5, 2007: 5.0, 2008: 3.0,
                            2009: 0.5, 2010: 0.3, 2011: 0.2, 2012: 0.1, 2013: 0.1,
                            2014: 0.1, 2015: 0.2, 2016: 0.5, 2017: 1.0, 2018: 2.0,
                            2019: 2.2, 2020: 0.6, 2021: 0.1, 2022: 2.5, 2023: 4.5, 2024: 4.2, 2025: 4.0
                        },
                        'CD_1YEAR': {
                            2004: 3.0, 2005: 4.0, 2006: 5.0, 2007: 5.5, 2008: 3.5,
                            2009: 1.0, 2010: 0.8, 2011: 0.7, 2012: 0.6, 2013: 0.6,
                            2014: 0.6, 2015: 0.7, 2016: 1.0, 2017: 1.5, 2018: 2.5,
                            2019: 2.7, 2020: 1.1, 2021: 0.6, 2022: 3.0, 2023: 5.0, 2024: 4.7, 2025: 4.5
                        },
                        'MONEY_MARKET': {
                            2004: 2.0, 2005: 3.0, 2006: 4.0, 2007: 4.5, 2008: 2.5,
                            2009: 0.3, 2010: 0.2, 2011: 0.1, 2012: 0.1, 2013: 0.1,
                            2014: 0.1, 2015: 0.1, 2016: 0.3, 2017: 0.8, 2018: 1.8,
                            2019: 2.0, 2020: 0.4, 2021: 0.1, 2022: 2.0, 2023: 4.0, 2024: 3.8, 2025: 3.5
                        }
                    },
                    'CA': {
                        'HIGH_INTEREST': {
                            2004: 2.2, 2005: 3.0, 2006: 4.0, 2007: 4.5, 2008: 2.5,
                            2009: 0.3, 2010: 0.5, 2011: 0.8, 2012: 1.0, 2013: 1.0,
                            2014: 0.8, 2015: 0.5, 2016: 0.5, 2017: 1.0, 2018: 1.5,
                            2019: 1.8, 2020: 0.5, 2021: 0.2, 2022: 2.0, 2023: 4.0, 2024: 3.8, 2025: 3.5
                        },
                        'GIC_1YEAR': {
                            2004: 2.7, 2005: 3.5, 2006: 4.5, 2007: 5.0, 2008: 3.0,
                            2009: 0.8, 2010: 1.0, 2011: 1.3, 2012: 1.5, 2013: 1.5,
                            2014: 1.3, 2015: 1.0, 2016: 1.0, 2017: 1.5, 2018: 2.0,
                            2019: 2.3, 2020: 1.0, 2021: 0.7, 2022: 2.5, 2023: 4.5, 2024: 4.3, 2025: 4.0
                        },
                        'TFSA': {
                            2004: 2.0, 2005: 2.8, 2006: 3.8, 2007: 4.3, 2008: 2.3,
                            2009: 0.2, 2010: 0.4, 2011: 0.7, 2012: 0.9, 2013: 0.9,
                            2014: 0.7, 2015: 0.4, 2016: 0.4, 2017: 0.9, 2018: 1.4,
                            2019: 1.7, 2020: 0.4, 2021: 0.1, 2022: 1.8, 2023: 3.8, 2024: 3.6, 2025: 3.3
                        }
                    },
                    'CN': {
                        'TERM_1YEAR': {
                            2004: 2.8, 2005: 3.2, 2006: 3.5, 2007: 4.1, 2008: 3.9,
                            2009: 3.3, 2010: 3.3, 2011: 3.5, 2012: 3.3, 2013: 3.3,
                            2014: 3.0, 2015: 2.8, 2016: 2.3, 2017: 2.1, 2018: 2.1,
                            2019: 2.1, 2020: 2.1, 2021: 2.1, 2022: 2.1, 2023: 2.2, 2024: 2.2, 2025: 2.3
                        },
                        'WEALTH_MGMT': {
                            2004: 3.5, 2005: 4.0, 2006: 4.3, 2007: 5.0, 2008: 4.5,
                            2009: 4.0, 2010: 4.0, 2011: 4.2, 2012: 4.0, 2013: 4.0,
                            2014: 3.8, 2015: 3.5, 2016: 3.2, 2017: 3.0, 2018: 3.0,
                            2019: 3.0, 2020: 3.0, 2021: 3.0, 2022: 3.0, 2023: 3.1, 2024: 3.1, 2025: 3.2
                        },
                        'STRUCTURED': {
                            2004: 3.0, 2005: 3.5, 2006: 3.8, 2007: 4.5, 2008: 4.2,
                            2009: 3.8, 2010: 3.8, 2011: 4.0, 2012: 3.8, 2013: 3.8,
                            2014: 3.5, 2015: 3.2, 2016: 2.8, 2017: 2.6, 2018: 2.6,
                            2019: 2.6, 2020: 2.6, 2021: 2.6, 2022: 2.6, 2023: 2.7, 2024: 2.7, 2025: 2.8
                        }
                    },
                    'AU': {
                        'HIGH_YIELD_SAVINGS': {
                            2004: 4.5, 2005: 5.0, 2006: 5.8, 2007: 6.5, 2008: 4.0,
                            2009: 3.0, 2010: 4.5, 2011: 4.8, 2012: 3.5, 2013: 2.5,
                            2014: 2.5, 2015: 2.0, 2016: 1.5, 2017: 1.5, 2018: 1.5,
                            2019: 1.0, 2020: 0.3, 2021: 0.1, 2022: 1.5, 2023: 4.0, 2024: 4.2, 2025: 4.0
                        },
                        'TERM_DEPOSIT': {
                            2004: 5.0, 2005: 5.5, 2006: 6.3, 2007: 7.0, 2008: 4.5,
                            2009: 3.5, 2010: 5.0, 2011: 5.3, 2012: 4.0, 2013: 3.0,
                            2014: 3.0, 2015: 2.5, 2016: 2.0, 2017: 2.0, 2018: 2.0,
                            2019: 1.5, 2020: 0.8, 2021: 0.6, 2022: 2.0, 2023: 4.5, 2024: 4.7, 2025: 4.5
                        },
                        'CASH_MGMT': {
                            2004: 4.0, 2005: 4.5, 2006: 5.3, 2007: 6.0, 2008: 3.5,
                            2009: 2.5, 2010: 4.0, 2011: 4.3, 2012: 3.0, 2013: 2.0,
                            2014: 2.0, 2015: 1.5, 2016: 1.0, 2017: 1.0, 2018: 1.0,
                            2019: 0.5, 2020: 0.1, 2021: 0.1, 2022: 1.0, 2023: 3.5, 2024: 3.7, 2025: 3.5
                        }
                    }
                };
                return rateMap[country]?.[bankProduct]?.[year] || 2.0;
            }, []);

            // æ¨¡æ‹ŸETFä»·æ ¼æ•°æ®
            const simulateETFData = useCallback((etfCode, country, startDate, endDate) => {
                const data = [];
                
                const basePrices = {
                    'US': { 'SPY': 120, 'VTI': 80, 'QQQ': 45, 'VXUS': 55, 'SCHB': 75 },
                    'CA': { 'VTI.TO': 25, 'TDB902': 15, 'VCN': 35, 'TDB900': 12 },
                    'CN': { '510300': 3.5, '159915': 2.0, '588000': 2.8, '510500': 4.2, '513100': 3.0 },
                    'AU': { 'VAS': 75, 'A200': 90, 'VGS': 85, 'VAF': 50 }
                };
                
                let currentPrice = basePrices[country]?.[etfCode] || 100;
                const start = new Date(startDate);
                const end = new Date(endDate);
                
                for (let date = new Date(start); date <= end; date.setMonth(date.getMonth() + 1)) {
                    const volatilityMap = { 'US': 0.12, 'CA': 0.10, 'CN': 0.18, 'AU': 0.11 };
                    const volatility = volatilityMap[country] || 0.12;
                    
                    const monthlyReturn = (Math.random() - 0.5) * volatility + 0.007;
                    
                    if (date.getFullYear() === 2008 && date.getMonth() >= 8) {
                        currentPrice *= 0.75;
                    } else if (date.getFullYear() === 2020 && date.getMonth() === 2) {
                        currentPrice *= 0.8;
                    } else {
                        currentPrice *= (1 + monthlyReturn);
                    }
                    
                    data.push({
                        date: new Date(date),
                        price: Number(currentPrice.toFixed(3)),
                        year: date.getFullYear(),
                        month: date.getMonth() + 1
                    });
                }
                
                return data;
            }, []);

            // è®¡ç®—æŠ•èµ„å›æµ‹ç»“æœ
            const backtestResults = useMemo(() => {
                if (!selectedETFs.length) return null;

                const startDate = new Date(startYear, startMonth - 1, 1);
                const endDate = new Date(endYear, endMonth - 1, 1);
                const currentMarket = marketData[selectedCountry];
                
                const etfDataSets = selectedETFs.map(etf => ({
                    code: etf,
                    data: simulateETFData(etf, selectedCountry, startDate, endDate)
                }));

                const results = [];
                let totalInvested = 0;
                let etfShares = {};
                let bankBalance = 0;

                selectedETFs.forEach(etf => etfShares[etf] = 0);

                for (let date = new Date(startDate); date <= endDate; date.setMonth(date.getMonth() + 1)) {
                    const year = date.getFullYear();
                    const month = date.getMonth() + 1;
                    const isFirstMonth = date.getTime() === startDate.getTime();
                    
                    const currentInvestment = isFirstMonth ? initialInvestment : monthlyAmount;
                    totalInvested += currentInvestment;
                    
                    const amountPerETF = currentInvestment / selectedETFs.length;
                    let totalETFValue = 0;
                    
                    selectedETFs.forEach((etf, index) => {
                        const etfData = etfDataSets[index].data.find(d => 
                            d.year === year && d.month === month
                        );
                        
                        if (etfData) {
                            etfShares[etf] += amountPerETF / etfData.price;
                            
                            const expenseRatio = currentMarket.etfs[etf].expenseRatio / 100;
                            const monthsHeld = ((year - startYear) * 12 + month - startMonth + 1);
                            const expenseReduction = Math.pow(1 - expenseRatio / 12, monthsHeld);
                            
                            totalETFValue += etfShares[etf] * etfData.price * expenseReduction;
                        }
                    });

                    const monthlyRate = getBankRate(selectedCountry, selectedBankProduct, year, month) / 100 / 12;
                    bankBalance = (bankBalance + currentInvestment) * (1 + monthlyRate);

                    results.push({
                        date: new Date(date),
                        year,
                        month,
                        totalInvested,
                        etfValue: Math.round(totalETFValue),
                        bankValue: Math.round(bankBalance),
                        etfReturn: totalInvested > 0 ? ((totalETFValue - totalInvested) / totalInvested * 100) : 0,
                        bankReturn: totalInvested > 0 ? ((bankBalance - totalInvested) / totalInvested * 100) : 0
                    });
                }

                return results;
            }, [startYear, startMonth, endYear, endMonth, selectedCountry, selectedETFs, selectedBankProduct, monthlyAmount, initialInvestment, simulateETFData, getBankRate]);

            // å¤„ç†æ•°æ®åˆ·æ–°
            const handleRefreshData = async () => {
                setIsLoading(true);
                await new Promise(resolve => setTimeout(resolve, 2000));
                setLastDataUpdate(new Date().toLocaleTimeString());
                setIsLoading(false);
            };

            // å¤„ç†ETFé€‰æ‹©
            const handleETFChange = (etfCode) => {
                setSelectedETFs(prev => 
                    prev.includes(etfCode)
                        ? prev.filter(code => code !== etfCode)
                        : [...prev, etfCode]
                );
            };

            // å¤„ç†å›½å®¶åˆ‡æ¢
            const handleCountryChange = (countryCode) => {
                setSelectedCountry(countryCode);
                setSelectedETFs([]);
                const defaultBankProducts = {
                    'US': 'HIGH_YIELD',
                    'CA': 'HIGH_INTEREST', 
                    'CN': 'TERM_1YEAR',
                    'AU': 'HIGH_YIELD_SAVINGS'
                };
                setSelectedBankProduct(defaultBankProducts[countryCode]);
            };

            // å¤„ç†é“¶è¡Œäº§å“é€‰æ‹©
            const handleBankProductChange = (productCode) => {
                setSelectedBankProduct(productCode);
            };

            // æ»‘å—ç»„ä»¶
            const CustomSlider = ({ label, value, min, max, step, onChange, unit, color }) => (
                React.createElement('div', { className: "mb-6" },
                    React.createElement('div', { className: "flex justify-between items-center mb-2" },
                        React.createElement('label', { className: "text-sm font-medium text-gray-700" }, label),
                        React.createElement('span', { className: `text-lg font-bold ${color}` }, 
                            marketData[selectedCountry].symbol + value.toLocaleString() + unit
                        )
                    ),
                    React.createElement('input', {
                        type: "range",
                        min: min,
                        max: max,
                        step: step,
                        value: value,
                        onChange: (e) => onChange(Number(e.target.value)),
                        className: "w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                    }),
                    React.createElement('div', { className: "flex justify-between text-xs text-gray-500 mt-1" },
                        React.createElement('span', {}, marketData[selectedCountry].symbol + min.toLocaleString()),
                        React.createElement('span', {}, marketData[selectedCountry].symbol + max.toLocaleString())
                    )
                )
            );

            // æ—¶é—´æ»‘å—ç»„ä»¶
            const TimeRangeSlider = ({ label, year, month, onYearChange, onMonthChange, minYear = 2004, maxYear = 2025 }) => (
                React.createElement('div', { className: "mb-4" },
                    React.createElement('label', { className: "text-sm font-medium text-gray-700 mb-2 block" }, label),
                    React.createElement('div', { className: "space-y-2" },
                        React.createElement('div', {},
                            React.createElement('span', { className: "text-xs text-gray-500" }, 'å¹´ä»½: ' + year),
                            React.createElement('input', {
                                type: "range",
                                min: minYear,
                                max: maxYear,
                                value: year,
                                onChange: (e) => onYearChange(Number(e.target.value)),
                                className: "w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                            })
                        ),
                        React.createElement('div', {},
                            React.createElement('span', { className: "text-xs text-gray-500" }, 'æœˆä»½: ' + month + 'æœˆ'),
                            React.createElement('input', {
                                type: "range",
                                min: 1,
                                max: 12,
                                value: month,
                                onChange: (e) => onMonthChange(Number(e.target.value)),
                                className: "w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                            })
                        )
                    )
                )
            );

            // è‡ªå®šä¹‰å·¥å…·æç¤º
            const CustomTooltip = ({ active, payload, label }) => {
                if (active && payload && payload.length) {
                    const data = payload[0].payload;
                    const currency = marketData[selectedCountry];
                    return React.createElement('div', { className: "bg-white p-4 border border-gray-200 rounded-lg shadow-lg" },
                        React.createElement('p', { className: "font-semibold text-gray-800 mb-2" }, `${data.year}å¹´${data.month}æœˆ`),
                        payload.map((entry, index) => 
                            React.createElement('p', { 
                                key: index, 
                                style: { color: entry.color }, 
                                className: "text-sm" 
                            }, `${entry.name}: ${currency.symbol}${entry.value?.toLocaleString()}`)
                        )
                    );
                }
                return null;
            };

            const finalResult = backtestResults?.[backtestResults.length - 1];
            const investmentPeriod = ((endYear - startYear) * 12 + endMonth - startMonth + 1);
            const currentMarket = marketData[selectedCountry];

            return React.createElement('div', { className: "max-w-7xl mx-auto p-6 bg-gradient-to-br from-purple-50 to-blue-100 min-h-screen" },
                React.createElement('div', { className: "bg-white rounded-2xl shadow-xl p-8" },
                    React.createElement('h1', { className: "text-3xl font-bold text-center text-gray-800 mb-8" },
                        'ğŸ“ˆ æŠ•èµ„å›æµ‹æ¨¡æ‹Ÿå™¨(åŸºäºçœŸå®å†å²æ•°æ®)'
                    ),
                    
                    React.createElement('div', { className: "grid lg:grid-cols-3 gap-8" },
                        // å·¦ä¾§æ§åˆ¶é¢æ¿
                        React.createElement('div', { className: "bg-gray-50 rounded-xl p-6" },
                            React.createElement('h2', { className: "text-xl font-bold text-gray-800 mb-6 flex items-center gap-2" },
                                React.createElement(Globe, { className: "w-5 h-5" }),
                                'æŠ•èµ„å‚æ•°è®¾ç½®'
                            ),
                            
                            // å›½å®¶å¸‚åœºé€‰æ‹©
                            React.createElement('div', { className: "mb-6" },
                                React.createElement('label', { className: "text-sm font-medium text-gray-700 mb-3 block" }, 'é€‰æ‹©æŠ•èµ„å¸‚åœº'),
                                React.createElement('div', { className: "grid grid-cols-2 gap-2" },
                                    Object.entries(marketData).map(([code, market]) =>
                                        React.createElement('button', {
                                            key: code,
                                            onClick: () => handleCountryChange(code),
                                            className: `p-3 rounded-lg text-sm font-medium transition-all ${
                                                selectedCountry === code
                                                    ? 'bg-blue-500 text-white shadow-lg'
                                                    : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                            }`
                                        },
                                            market.name,
                                            React.createElement('div', { className: "text-xs opacity-75" }, market.currency)
                                        )
                                    )
                                )
                            ),

                            // æŠ•èµ„é‡‘é¢è®¾ç½®
                            React.createElement(CustomSlider, {
                                label: "åˆå§‹æŠ•èµ„é‡‘é¢",
                                value: initialInvestment,
                                min: 0,
                                max: 100000,
                                step: 1000,
                                onChange: setInitialInvestment,
                                unit: "",
                                color: "text-purple-600"
                            }),
                            
                            React.createElement(CustomSlider, {
                                label: "æ¯æœˆæŠ•èµ„é‡‘é¢",
                                value: monthlyAmount,
                                min: 100,
                                max: 5000,
                                step: 100,
                                onChange: setMonthlyAmount,
                                unit: "",
                                color: "text-blue-600"
                            }),

                            // æ—¶é—´èŒƒå›´é€‰æ‹©
                            React.createElement(TimeRangeSlider, {
                                label: "å›æµ‹å¼€å§‹æ—¶é—´",
                                year: startYear,
                                month: startMonth,
                                onYearChange: setStartYear,
                                onMonthChange: setStartMonth
                            }),
                            
                            React.createElement(TimeRangeSlider, {
                                label: "å›æµ‹ç»“æŸæ—¶é—´",
                                year: endYear,
                                month: endMonth,
                                onYearChange: setEndYear,
                                onMonthChange: setEndMonth
                            }),

                            // ETFäº§å“é€‰æ‹©
                            React.createElement('div', { className: "mb-6" },
                                React.createElement('div', { className: "flex items-center justify-between mb-3" },
                                    React.createElement('label', { className: "text-sm font-medium text-gray-700" },
                                        'é€‰æ‹©' + currentMarket.name + 'è‚¡ç¥¨äº§å“'
                                    ),
                                    React.createElement('button', {
                                        onClick: handleRefreshData,
                                        disabled: isLoading,
                                        className: `flex items-center gap-1 px-3 py-1 rounded-lg text-xs transition-colors ${
                                            isLoading
                                                ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                                                : 'bg-blue-100 text-blue-700 hover:bg-blue-200'
                                        }`
                                    },
                                        React.createElement(RefreshCw, { className: `w-3 h-3 ${isLoading ? 'animate-spin' : ''}` }),
                                        isLoading ? 'è·å–ä¸­...' : 'åˆ·æ–°æ•°æ®'
                                    )
                                ),
                                
                                React.createElement('div', { className: "space-y-3 max-h-64 overflow-y-auto" },
                                    Object.entries(currentMarket.etfs).map(([code, info]) =>
                                        React.createElement('div', { key: code, className: "p-3 bg-white rounded-lg border" },
                                            React.createElement('div', { className: "flex items-start gap-2" },
                                                React.createElement('input', {
                                                    type: "checkbox",
                                                    id: code,
                                                    checked: selectedETFs.includes(code),
                                                    onChange: () => handleETFChange(code),
                                                    className: "w-4 h-4 text-blue-600 rounded focus:ring-blue-500 mt-1"
                                                }),
                                                React.createElement('div', { className: "flex-1" },
                                                    React.createElement('label', { 
                                                        htmlFor: code, 
                                                        className: "font-medium text-gray-900 cursor-pointer text-sm" 
                                                    }, code + ' - ' + info.name),
                                                    React.createElement('div', { className: "text-xs text-gray-600 mt-1" },
                                                        info.description
                                                    ),
                                                    React.createElement('div', { className: "text-xs text-orange-600 font-bold mt-1" },
                                                        'ç®¡ç†è´¹ç”¨: ' + info.expenseRatio + '% / å¹´'
                                                    )
                                                )
                                            )
                                        )
                                    )
                                ),
                                
                                lastDataUpdate && React.createElement('div', { className: "text-xs text-gray-500 mt-2" },
                                    'æœ€åæ›´æ–°: ' + lastDataUpdate
                                )
                            ),

                            // é“¶è¡Œäº§å“é€‰æ‹©
                            React.createElement('div', { className: "mb-6" },
                                React.createElement('label', { className: "text-sm font-medium text-gray-700 mb-3 block" },
                                    'é€‰æ‹©' + currentMarket.name + 'é“¶è¡Œäº§å“'
                                ),
                                React.createElement('div', { className: "space-y-3" },
                                    Object.entries(currentMarket.banks).map(([code, info]) =>
                                        React.createElement('div', { key: code, className: "p-3 bg-white rounded-lg border" },
                                            React.createElement('div', { className: "flex items-start gap-2" },
                                                React.createElement('input', {
                                                    type: "radio",
                                                    id: `bank-${code}`,
                                                    name: "bankProduct",
                                                    checked: selectedBankProduct === code,
                                                    onChange: () => handleBankProductChange(code),
                                                    className: "w-4 h-4 text-orange-600 focus:ring-orange-500 mt-1"
                                                }),
                                                React.createElement('div', { className: "flex-1" },
                                                    React.createElement('label', { 
                                                        htmlFor: `bank-${code}`, 
                                                        className: "font-medium text-gray-900 cursor-pointer text-sm" 
                                                    }, info.name),
                                                    React.createElement('div', { className: "text-xs text-gray-600 mt-1" },
                                                        info.description
                                                    ),
                                                    React.createElement('div', { className: "text-xs text-green-600 font-bold mt-1" },
                                                        info.riskLevel
                                                    )
                                                )
                                            )
                                        )
                                    )
                                )
                            )
                        ),

                        // ä¸­é—´å’Œå³ä¾§ - ç»“æœå±•ç¤º
                        React.createElement('div', { className: "lg:col-span-2 space-y-8" },
                            // å…³é”®æŒ‡æ ‡æ±‡æ€»
                            finalResult && React.createElement('div', { className: "bg-gray-50 rounded-xl p-6" },
                                React.createElement('h2', { className: "text-xl font-bold text-gray-800 mb-6 flex items-center gap-2" },
                                    React.createElement(TrendingUp, { className: "w-5 h-5" }),
                                    currentMarket.name + 'å¸‚åœºå›æµ‹ç»“æœ'
                                ),
                                
                                React.createElement('div', { className: "grid grid-cols-2 md:grid-cols-3 gap-4 mb-6" },
                                    React.createElement('div', { className: "bg-blue-500 text-white rounded-lg p-4 text-center" },
                                        React.createElement('div', { className: "text-sm opacity-90" }, 'è‚¡ç¥¨äº§å“ä»·å€¼'),
                                        React.createElement('div', { className: "text-xl font-bold" },
                                            currentMarket.symbol + finalResult.etfValue.toLocaleString()
                                        )
                                    ),
                                    React.createElement('div', { className: "bg-orange-500 text-white rounded-lg p-4 text-center" },
                                        React.createElement('div', { className: "text-sm opacity-90" }, 'é“¶è¡Œå­˜æ¬¾ä»·å€¼'),
                                        React.createElement('div', { className: "text-xl font-bold" },
                                            currentMarket.symbol + finalResult.bankValue.toLocaleString()
                                        )
                                    ),
                                    React.createElement('div', { className: "bg-green-500 text-white rounded-lg p-4 text-center" },
                                        React.createElement('div', { className: "text-sm opacity-90" }, 'æ€»æŠ•å…¥é‡‘é¢'),
                                        React.createElement('div', { className: "text-xl font-bold" },
                                            currentMarket.symbol + finalResult.totalInvested.toLocaleString()
                                        )
                                    )
                                ),

                                React.createElement('div', { className: "grid grid-cols-2 gap-4 text-sm" },
                                    React.createElement('div', { className: "bg-white p-4 rounded-lg" },
                                        React.createElement('h4', { className: "font-semibold text-gray-800 mb-2" }, 'è‚¡ç¥¨äº§å“æŠ•èµ„è¡¨ç°'),
                                        React.createElement('ul', { className: "space-y-1 text-gray-600" },
                                            React.createElement('li', {}, 'â€¢ æ€»æ”¶ç›Šç‡: ' + finalResult.etfReturn.toFixed(2) + '%'),
                                            React.createElement('li', {}, 'â€¢ å¹´åŒ–æ”¶ç›Šç‡: ' + (finalResult.etfReturn / investmentPeriod * 12).toFixed(2) + '%'),
                                            React.createElement('li', {}, 'â€¢ æŠ•èµ„æœŸé—´: ' + investmentPeriod + 'ä¸ªæœˆ'),
                                            React.createElement('li', {}, 'â€¢ é€‰æ‹©äº§å“: ' + selectedETFs.join(', '))
                                        )
                                    ),
                                    
                                    React.createElement('div', { className: "bg-white p-4 rounded-lg" },
                                        React.createElement('h4', { className: "font-semibold text-gray-800 mb-2" }, 'é“¶è¡Œå­˜æ¬¾è¡¨ç°'),
                                        React.createElement('ul', { className: "space-y-1 text-gray-600" },
                                            React.createElement('li', {}, 'â€¢ æ€»æ”¶ç›Šç‡: ' + finalResult.bankReturn.toFixed(2) + '%'),
                                            React.createElement('li', {}, 'â€¢ å¹´åŒ–æ”¶ç›Šç‡: ' + (finalResult.bankReturn / investmentPeriod * 12).toFixed(2) + '%'),
                                            React.createElement('li', {}, 'â€¢ å¤åˆ©æ–¹å¼: æœˆå¤åˆ©è®¡ç®—'),
                                            React.createElement('li', {}, 'â€¢ é£é™©ç­‰çº§: æä½é£é™©')
                                        )
                                    )
                                )
                            ),

                            // å†å²èµ°åŠ¿å›¾è¡¨
                            backtestResults && React.createElement('div', { className: "bg-gray-50 rounded-xl p-6" },
                                React.createElement('h2', { className: "text-xl font-bold text-gray-800 mb-6" }, 'ğŸ“Š å†å²æŠ•èµ„èµ°åŠ¿å¯¹æ¯”'),
                                
                                React.createElement(ResponsiveContainer, { width: "100%", height: 400 },
                                    React.createElement(LineChart, { 
                                        data: backtestResults, 
                                        margin: { top: 20, right: 30, left: 20, bottom: 60 } 
                                    },
                                        React.createElement(CartesianGrid, { strokeDasharray: "3 3" }),
                                        React.createElement(XAxis, { 
                                            dataKey: "date",
                                            tickFormatter: (date) => {
                                                const d = new Date(date);
                                                return `${d.getFullYear()}/${d.getMonth() + 1}`;
                                            },
                                            interval: "preserveStartEnd",
                                            angle: -45,
                                            textAnchor: "end",
                                            height: 60
                                        }),
                                        React.createElement(YAxis, { 
                                            tickFormatter: (value) => `${currentMarket.symbol}${(value / 10000).toFixed(0)}ä¸‡`,
                                            label: { value: 'é‡‘é¢', angle: -90, position: 'insideLeft' }
                                        }),
                                        React.createElement(Tooltip, { content: CustomTooltip }),
                                        React.createElement(Legend),
                                        
                                        React.createElement(Line, { 
                                            type: "monotone", 
                                            dataKey: "totalInvested", 
                                            stroke: "#10b981", 
                                            strokeWidth: 2,
                                            name: "ç´¯è®¡æŠ•å…¥",
                                            dot: false
                                        }),
                                        React.createElement(Line, { 
                                            type: "monotone", 
                                            dataKey: "etfValue", 
                                            stroke: "#3b82f6", 
                                            strokeWidth: 3,
                                            name: "è‚¡ç¥¨äº§å“ä»·å€¼",
                                            dot: false
                                        }),
                                        React.createElement(Line, { 
                                            type: "monotone", 
                                            dataKey: "bankValue", 
                                            stroke: "#f59e0b", 
                                            strokeWidth: 2,
                                            name: "é“¶è¡Œå­˜æ¬¾ä»·å€¼",
                                            dot: false
                                        })
                                    )
                                )
                            ),

                            // æŠ•èµ„æ´å¯Ÿåˆ†æ
                            finalResult && React.createElement('div', { className: "bg-white rounded-lg p-6 border-l-4 border-purple-500" },
                                React.createElement('h3', { className: "font-bold text-gray-800 mb-4 flex items-center gap-2" },
                                    React.createElement(DollarSign, { className: "w-5 h-5" }),
                                    currentMarket.name + 'å¸‚åœºæŠ•èµ„æ´å¯Ÿ'
                                ),
                                
                                React.createElement('div', { className: "space-y-3 text-sm text-gray-600" },
                                    React.createElement('div', { className: "p-3 bg-blue-50 rounded-lg" },
                                        React.createElement('p', { className: "font-medium text-blue-800" },
                                            'ğŸ“Š å†å²è¡¨ç°åˆ†æ'
                                        ),
                                        React.createElement('p', { className: "mt-1" },
                                            `åœ¨${startYear}å¹´${startMonth}æœˆåˆ°${endYear}å¹´${endMonth}æœˆæœŸé—´ï¼Œ` +
                                            `åœ¨${currentMarket.name}å¸‚åœºæŠ•èµ„è‚¡ç¥¨äº§å“æ¯”é“¶è¡Œå­˜æ¬¾å¤šè·å¾—` +
                                            `${currentMarket.symbol}${(finalResult.etfValue - finalResult.bankValue).toLocaleString()}æ”¶ç›Šï¼Œ` +
                                            `ç›¸å½“äºé¢å¤–${((finalResult.etfValue - finalResult.bankValue) / finalResult.totalInvested * 100).toFixed(1)}%çš„å›æŠ¥ç‡ã€‚`
                                        )
                                    ),
                                    
                                    React.createElement('div', { className: "p-3 bg-yellow-50 rounded-lg" },
                                        React.createElement('p', { className: "font-medium text-yellow-800" },
                                            'âš ï¸ æŠ•èµ„é£é™©æç¤º'
                                        ),
                                        React.createElement('p', { className: "mt-1" },
                                            `å†å²è¡¨ç°ä¸ä»£è¡¨æœªæ¥æ”¶ç›Šï¼Œè‚¡ç¥¨æŠ•èµ„å­˜åœ¨æœ¬é‡‘æŸå¤±é£é™©ã€‚` +
                                            `${currentMarket.name}å¸‚åœºå…·æœ‰å…¶ç‰¹å®šçš„æ”¿ç­–ã€ç»æµç¯å¢ƒå½±å“ã€‚` +
                                            `å»ºè®®æ ¹æ®ä¸ªäººé£é™©æ‰¿å—èƒ½åŠ›å’ŒæŠ•èµ„æœŸé™åˆç†é…ç½®èµ„äº§ã€‚`
                                        )
                                    ),
                                    
                                    React.createElement('div', { className: "p-3 bg-green-50 rounded-lg" },
                                        React.createElement('p', { className: "font-medium text-green-800" },
                                            'ğŸ’¡ æŠ•èµ„ç­–ç•¥å»ºè®®'
                                        ),
                                        React.createElement('p', { className: "mt-1" },
                                            `é•¿æœŸå®šæŠ•åœ¨${currentMarket.name}å¸‚åœºå†å²ä¸Šè¡¨ç°ä¼˜å¼‚ï¼Œ` +
                                            `ä½†éœ€è¦æ‰¿å—çŸ­æœŸæ³¢åŠ¨ã€‚å»ºè®®é‡‡ç”¨è‚¡ç¥¨äº§å“ + é“¶è¡Œå­˜æ¬¾çš„ç»„åˆç­–ç•¥ï¼Œ` +
                                            `åœ¨è¿½æ±‚æ”¶ç›Šçš„åŒæ—¶ä¿æŒèµ„äº§é…ç½®çš„ç¨³å¥æ€§ã€‚`
                                        )
                                    )
                                )
                            )
                        )
                    )
                )
            );
        }

        ReactDOM.render(React.createElement(InvestmentBacktestingSimulator), document.getElementById('root'));
    </script>
</body>
</html>